<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History Legends | v33.0 ENHANCED</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');
        body { background-color: #0b0f19; color: #e2e8f0; font-family: 'Outfit', sans-serif; height: 100vh; overflow: hidden; }
        
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); }
        
        /* Taburi */
        .tab-btn { padding: 8px 16px; border-radius: 8px; font-weight: bold; font-size: 11px; text-transform: uppercase; transition: 0.2s; border: 1px solid transparent; white-space: nowrap; }
        .tab-btn:hover { background: rgba(255,255,255,0.1); }
        
        body.is-student .tab-btn.active { background: #2563eb; color: white; border-color: #3b82f6; }
        body.is-teacher .tab-btn.active { background: #b91c1c; color: white; border-color: #ef4444; }

        /* Vizibilitate */
        .only-prof { display: none !important; }
        .only-elev { display: none !important; }
        body.is-teacher .only-prof { display: flex !important; }
        body.is-student .only-elev { display: flex !important; }
        body.is-teacher div.only-prof.block-mode { display: block !important; }

        /* Editabile */
        .editable:hover { background: rgba(255,255,255,0.1); cursor: text; border-radius: 4px; }
        .t-input { background: transparent; width: 100%; color: white; font-size: 12px; text-align: center; }
        .t-input:focus { background: #1e293b; outline: none; }

        /* Upload Zone */
        .upload-zone { border: 2px dashed rgba(59, 130, 246, 0.5); transition: all 0.3s; }
        .upload-zone:hover { border-color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
        .upload-zone.dragover { border-color: #10b981; background: rgba(16, 185, 129, 0.1); }

        /* File Item */
        .file-item { background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(255,255,255,0.1); transition: all 0.2s; }
        .file-item:hover { background: rgba(30, 41, 59, 0.8); border-color: rgba(59, 130, 246, 0.5); }

        /* Timer Animation */
        @keyframes pulse-timer { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .timer-warning { animation: pulse-timer 1s infinite; color: #ef4444; }

        /* Progress Bar */
        .progress-bar { transition: width 0.3s ease; }

        /* Modal Overlay */
        .modal-overlay { backdrop-filter: blur(5px); }

        /* Live Indicator */
        .live-dot { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        
        /* Mode Buttons */
        .mode-btn { transition: all 0.3s ease; }
        
        /* Chat Bubbles Animation */
        .chat-bubble { animation: fadeInUp 0.3s ease-out; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
    <script>
        // ============================================
        // API CONFIGURATION (Deepseek R1 / Mistral)
        // ============================================
        
        const AI_CONFIG = {
            // CRITICAL: √énlocuie»ôte cu API keys reale (sau mutƒÉ √Æn Cloudflare Worker pentru securitate)
            keys: {
                deepseek: '', // https://platform.deepseek.com/api_keys
                mistral: ''   // https://console.mistral.ai/api-keys
            },
            endpoints: {
                deepseek: 'https://api.deepseek.com/chat/completions',
                mistral: 'https://api.mistral.ai/v1/chat/completions'
            },
            models: {
                deepseek_standard: 'deepseek-chat',      // DeepSeek-V3.2 (FAST)
                deepseek_thinking: 'deepseek-reasoner',  // DeepSeek-R1 (DEEP)
                mistral: 'mistral-medium'                // Backup failover
            },
            // PRODUCTION: SchimbƒÉ cu Worker URL dupƒÉ deployment
            // workerEndpoint: 'https://mentor-ai.contact-ai.workers.dev'
            workerEndpoint: null // null = apel direct (DOAR pentru testing local cu API keys √Æn browser)
        };
        
        // Func»õie helper pentru apeluri API
        async function callAIProvider(prompt, systemMessage = '') {
            if (!AI_CONFIG.apiKey) {
                console.warn('‚ö†Ô∏è API Key lipse»ôte! Returnez rƒÉspuns simulat.');
                return generateSimulatedResponse(prompt);
            }
            
            try {
                const endpoint = AI_CONFIG.endpoints[AI_CONFIG.provider];
                const model = AI_CONFIG.models[AI_CONFIG.provider];
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${AI_CONFIG.apiKey}`
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [
                            systemMessage ? { role: 'system', content: systemMessage } : null,
                            { role: 'user', content: prompt }
                        ].filter(Boolean),
                        temperature: 0.7,
                        max_tokens: 1000
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('Eroare API:', error);
                return generateSimulatedResponse(prompt);
            }
        }
        
        // Fallback: rƒÉspuns simulat dacƒÉ API-ul nu e disponibil
        function generateSimulatedResponse(prompt) {
            const responses = {
                ro: [
                    'RƒÉspuns bun! Elevul a identificat corect principalele idei. NotƒÉ sugeratƒÉ: 9/10. Recomandare: Ar putea detalia mai mult rolul factorilor economici.',
                    'RƒÉspuns satisfƒÉcƒÉtor, dar lipsesc detalii despre cauze. NotƒÉ: 7/10. Sugestie: AdaugƒÉ exemple concrete din surse istorice.',
                    'Excelent! Analiza este profundƒÉ »ôi bine argumentatƒÉ. NotƒÉ: 10/10. Elevul demonstreazƒÉ √Æn»õelegere superioarƒÉ a proceselor istorice.'
                ],
                ru: [
                    '–•–æ—Ä–æ—à–∏–π –æ—Ç–≤–µ—Ç! –£—á–µ–Ω–∏–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏–ª –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–¥–µ–∏. –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è –æ—Ü–µ–Ω–∫–∞: 9/10. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ú–æ–∂–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ–ø–∏—Å–∞—Ç—å —Ä–æ–ª—å —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤.',
                    '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, –Ω–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ—Ç–∞–ª–µ–π –æ –ø—Ä–∏—á–∏–Ω–∞—Ö. –û—Ü–µ–Ω–∫–∞: 7/10. –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.',
                    '–û—Ç–ª–∏—á–Ω–æ! –ê–Ω–∞–ª–∏–∑ –≥–ª—É–±–æ–∫–∏–π –∏ —Ö–æ—Ä–æ—à–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π. –û—Ü–µ–Ω–∫–∞: 10/10. –£—á–µ–Ω–∏–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.'
                ]
            };
            
            const lang = typeof cL !== 'undefined' && cL === 'RU' ? 'ru' : 'ro';
            return responses[lang][Math.floor(Math.random() * responses[lang].length)];
        }
    </script>
</head>
<body class="is-student">

   <div id="login-screen" style="display: flex;" class="fixed inset-0 z-[9999] items-center justify-center bg-[#0b0f19]">
        <div class="glass p-10 rounded-[2rem] w-full max-w-md text-center border-t border-white/10 shadow-2xl">
            <div class="w-20 h-20 bg-blue-600 rounded-3xl flex items-center justify-center mx-auto mb-6 text-4xl text-white font-black">Œ©</div>
            <h1 class="text-3xl font-bold text-white mb-2">History Cosmos</h1>
            <p class="text-xs text-slate-400 mb-8 uppercase tracking-widest">Sistem Securizat D1</p>
            
            <div class="space-y-4">
                <input type="text" id="user-input" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white outline-none focus:border-blue-500" placeholder="Utilizator">
                <input type="password" id="pass-input" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white outline-none focus:border-blue-500" placeholder="ParolƒÉ">
                
                <div class="flex gap-2">
                    <button onclick="handleAuth('login')" class="flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl transition border-b-4 border-blue-800 active:border-b-0 active:translate-y-1">INTRƒÇ</button>
                    <button onclick="handleAuth('register')" class="flex-1 bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-xl transition border-b-4 border-green-800 active:border-b-0 active:translate-y-1">CONT NOU</button>
                </div>
            </div>

            <p id="login-msg" class="text-xs text-red-400 mt-4 h-4"></p>
        </div>
    </div>

    <div id="app-screen" style="display: none;" class="h-screen w-full flex-col">
        
        <header class="h-16 bg-[#0f1623] border-b border-slate-800 flex items-center justify-between px-6 z-50 flex-shrink-0">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center font-black text-xl text-white">Œ©</div>
                <div>
                    <h1 class="font-bold text-lg text-white leading-none">HISTORY <span class="text-blue-500">COSMOS</span></h1>
                    <p class="text-[10px] text-slate-400 font-mono" id="date-txt">...</p>
                </div>
            </div>

            <div class="only-prof items-center gap-4 bg-slate-800 px-4 py-1.5 rounded-xl border border-slate-700">
                <div class="flex items-center gap-2 text-red-400 border-r border-slate-700 pr-4 editable" onclick="editTxt(this)">
                    <i class="fa-solid fa-bell animate-pulse"></i><span class="text-xs font-bold uppercase">2 URGENTE</span>
                </div>
                <div class="flex items-center gap-2 text-yellow-400 border-r border-slate-700 pr-4 editable" onclick="editTxt(this)">
                    <i class="fa-solid fa-star"></i><span class="text-xs font-bold uppercase">IMPORTANT</span>
                </div>
                <div class="flex items-center gap-2 text-blue-400 editable" onclick="editTxt(this)">
                    <i class="fa-solid fa-calendar"></i><span class="text-xs font-bold uppercase">AZI: 3 LEC»öII</span>
                </div>
            </div>

            <div class="only-elev items-center gap-6 bg-slate-800 px-6 py-2 rounded-full border border-slate-700">
                <span class="text-xs font-bold text-blue-400" data-i18n="welcome">BINE AI VENIT!</span>
            </div>

            <div class="flex items-center gap-4">
                <button onclick="changeLang()" class="text-xs font-bold text-slate-400 border border-slate-600 px-2 py-1 rounded" id="lang-ind">RO</button>
                <div class="text-right hidden sm:block">
                    <div class="text-sm font-bold text-white" id="u-name">...</div>
                    <div class="text-[10px] font-bold" id="u-role">...</div>
                </div>
                <button onclick="location.reload()" class="text-slate-500 hover:text-white"><i class="fa-solid fa-power-off"></i></button>
            </div>
        </header>

        <main class="flex-grow flex overflow-hidden">
            
            <aside class="w-72 bg-[#0b0f19] border-r border-slate-800 flex flex-col z-20 flex-shrink-0">
                <div class="p-4 border-b border-slate-800 flex gap-1">
                    <button onclick="changeClass('X')" id="class-X" class="flex-1 py-1.5 text-xs font-bold rounded bg-blue-600 text-white">X</button>
                    <button onclick="changeClass('XI')" id="class-XI" class="flex-1 py-1.5 text-xs font-bold rounded text-slate-500 hover:bg-slate-800">XI</button>
                    <button onclick="changeClass('XII')" id="class-XII" class="flex-1 py-1.5 text-xs font-bold rounded text-slate-500 hover:bg-slate-800">XII</button>
                </div>
                <div class="p-5 font-bold text-[10px] text-slate-500 uppercase tracking-widest" data-i18n="pdld">PLAN CADRU</div>
                
                <div class="flex-grow overflow-y-auto px-4 space-y-3">
                    <div class="bg-blue-900/20 border border-blue-500/30 p-3 rounded-lg"><p class="text-[9px] text-blue-300 font-bold mb-1 opacity-70">U1</p><p class="text-xs text-white font-bold leading-tight">Orientul Antic</p></div>
                </div>

                <div class="p-4 border-t border-slate-800 bg-[#161b22]">
                    <p class="text-[10px] font-bold text-green-500 uppercase mb-2" data-i18n="today_topic">TEMA LEC»öIEI DE AZI</p>
                    <div class="only-prof flex-col gap-2">
                        <textarea id="topic-edit" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-xs text-white h-16 outline-none focus:border-red-500">Orientul Antic: Egiptul</textarea>
                        <button onclick="pubTopic()" class="w-full bg-red-600 hover:bg-red-500 text-white text-[10px] font-bold py-2 rounded-lg" data-i18n="publish">PUBLICƒÇ</button>
                    </div>
                    <div class="only-elev">
                        <p class="text-sm font-bold text-white leading-tight mb-3" id="topic-view">Orientul Antic: Egiptul</p>
                        <button onclick="nav('manual')" class="w-full bg-blue-600/20 hover:bg-blue-600 text-blue-400 hover:text-white text-[10px] font-bold py-2 rounded-lg" data-i18n="go">MERGI LA LEC»öIE</button>
                    </div>
                </div>
            </aside>

            <section class="flex-grow flex flex-col bg-slate-950 relative min-w-0">
                
                <div class="h-14 border-b border-slate-800 bg-[#0b0f19] flex items-center px-6 gap-2 overflow-x-auto">
                    <button onclick="nav('admin')" id="t-admin" class="only-prof tab-btn bg-red-900/20 text-red-400 border-red-500/30 hover:bg-red-500 hover:text-white"><i class="fa-solid fa-users-gear mr-2"></i><span data-i18n="control_panel">PANOU CONTROL</span></button>
                    <div class="only-prof w-px h-6 bg-slate-700 mx-2"></div>

                    <button onclick="nav('mentor')" id="t-mentor" class="tab-btn active"><i class="fa-solid fa-headset mr-2"></i><span data-i18n="mentor">MENTOR</span></button>
                    <button onclick="nav('manual')" id="t-manual" class="tab-btn"><i class="fa-solid fa-book-open mr-2"></i><span data-i18n="manual">MANUAL</span></button>
                    <button onclick="nav('homework')" id="t-homework" class="tab-btn"><i class="fa-solid fa-pencil mr-2"></i><span data-i18n="homework_tab">TEMƒÇ</span></button>
                    <button onclick="nav('uploads')" id="t-uploads" class="tab-btn"><i class="fa-solid fa-cloud-arrow-up mr-2"></i><span data-i18n="uploads">MATERIALE</span></button>
                    <button onclick="nav('online')" id="t-online" class="tab-btn"><i class="fa-solid fa-video mr-2"></i><span data-i18n="online_lesson">LEC»öIE ONLINE</span></button>
                    <button onclick="nav('quiz')" id="t-quiz" class="tab-btn"><i class="fa-solid fa-clock mr-2"></i><span data-i18n="quiz">EVALUARE</span></button>
                </div>

                <div class="flex-grow overflow-y-auto p-8 relative">

                    <!-- PANOU CONTROL PROFESOR -->
                    <div id="v-admin" class="view-content hidden flex-col h-full">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold text-white"><span data-i18n="register">Registru Clasa</span> <span id="class-header-display">X-A</span></h2>
                            <button onclick="openModal()" class="bg-red-600 text-white text-xs px-4 py-2 rounded-lg font-bold hover:bg-red-500 flex items-center gap-2"><i class="fa-solid fa-user-plus"></i><span data-i18n="add_student">√éNSCRIE ELEV</span></button>
                        </div>
                        <div class="glass rounded-xl overflow-hidden p-2">
                            <table class="w-full text-left reg-table" id="reg-table">
                                <thead class="text-xs uppercase text-slate-500 bg-slate-900/50">
                                    <tr>
                                        <th class="p-2" data-i18n="name">Nume</th>
                                        <th class="p-2 text-center" data-i18n="grades">Note</th>
                                        <th class="p-2 text-center" data-i18n="absences">Absen»õe</th>
                                        <th class="p-2" data-i18n="notes">Note/Obs</th>
                                    </tr>
                                </thead>
                                <tbody class="text-sm text-slate-300">
                                    <tr class="border-b border-slate-800 hover:bg-slate-800/30">
                                        <td class="p-2 font-bold text-white">Ana Moraru</td>
                                        <td class="p-2 text-center"><input type="text" class="t-input" value="10"></td>
                                        <td class="p-2 text-center"><input type="text" class="t-input text-red-400" value=""></td>
                                        <td class="p-2"><input type="text" class="t-input text-left" placeholder="..."></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- CRONICUS AI - SISTEM DUAL MODE -->
                    <div id="v-mentor" class="view-content flex flex-col h-full">
                        <div class="mb-6">
                            <h2 class="text-2xl font-bold text-white mb-2">CRONICUS <span class="text-blue-400">AI</span></h2>
                            <p class="text-sm text-slate-400">Sistem expert pentru istorie - Republica Moldova (clasele X-XII)</p>
                        </div>
                        
                        <!-- SELECTOR MODE -->
                        <div class="glass rounded-2xl p-4 mb-6">
                            <p class="text-sm font-bold text-slate-300 mb-3">SelecteazƒÉ modul de rƒÉspuns:</p>
                            <div class="flex gap-4">
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="cronicus-mode" value="rapid" class="hidden peer" checked>
                                    <div class="bg-slate-800 border-2 border-slate-700 peer-checked:border-blue-500 peer-checked:bg-blue-900/20 p-4 rounded-xl text-center transition-all hover:bg-slate-700/50">
                                        <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-3">
                                            <i class="fa-solid fa-bolt text-white"></i>
                                        </div>
                                        <h3 class="font-bold text-white mb-1">‚ö° MOD RAPID</h3>
                                        <p class="text-xs text-slate-400">120-200 cuvinte ‚Ä¢ Mistral 7B</p>
                                        <p class="text-xs text-slate-300 mt-2">RƒÉspunsuri concise pentru √ÆntrebƒÉri directe</p>
                                    </div>
                                </label>
                                
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="cronicus-mode" value="profund" class="hidden peer">
                                    <div class="bg-slate-800 border-2 border-slate-700 peer-checked:border-purple-500 peer-checked:bg-purple-900/20 p-4 rounded-xl text-center transition-all hover:bg-slate-700/50">
                                        <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center mx-auto mb-3">
                                            <i class="fa-solid fa-graduation-cap text-white"></i>
                                        </div>
                                        <h3 class="font-bold text-white mb-1">üéì MOD PROFUND</h3>
                                        <p class="text-xs text-slate-400">AnalizƒÉ detaliatƒÉ ‚Ä¢ Llama 70B</p>
                                        <p class="text-xs text-slate-300 mt-2">Evaluare eseuri BAC + analizƒÉ multicauzalƒÉ</p>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- ZONƒÇ √éNTREBARE -->
                        <div class="glass rounded-2xl p-6 mb-6 flex-grow flex flex-col">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-purple-600 rounded-full flex items-center justify-center">
                                    <i class="fa-solid fa-robot text-white"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-white">CRONICUS</h3>
                                    <p class="text-xs text-slate-400" id="mode-indicator">Mod: Rapid (120-200 cuvinte)</p>
                                </div>
                            </div>
                            
                            <div class="flex-grow overflow-y-auto mb-6" id="cronicus-chat">
                                <!-- Mesajul de bun venit -->
                                <div class="flex gap-3 mb-6">
                                    <div class="w-8 h-8 bg-slate-700 rounded-full flex items-center justify-center flex-shrink-0">
                                        <i class="fa-solid fa-robot text-blue-400 text-sm"></i>
                                    </div>
                                    <div class="bg-slate-800 p-4 rounded-2xl rounded-tl-none max-w-xl">
                                        <p class="text-sm text-slate-300">Salut! Sunt <span class="text-blue-400 font-bold">CRONICUS</span>, mentorul tƒÉu de istorie pentru Republica Moldova. Cu ce te pot ajuta astƒÉzi?</p>
                                        <p class="text-xs text-slate-500 mt-2">üí° <strong>Sfat:</strong> Pentru rƒÉspunsuri rapide, folose»ôte modul ‚ö°. Pentru analize detaliate »ôi evaluare eseuri BAC, alege modul üéì.</p>
                                    </div>
                                </div>
                                
                                <!-- RƒÉspunsurile vor apƒÉrea aici -->
                                <div id="cronicus-responses"></div>
                            </div>
                            
                            <!-- INPUT ZONE -->
                            <div class="space-y-4">
                                <div>
                                    <label class="text-sm font-bold text-slate-300 mb-2 block">√éntrebare / Eseu pentru evaluare:</label>
                                    <textarea
                                        id="cronicus-question"
                                        class="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 text-white text-sm h-32 outline-none focus:border-blue-500 resize-none"
                                        placeholder="Scrie √Æntrebarea ta de istorie sau √ÆncarcƒÉ un eseu pentru evaluare BAC..."
                                        data-i18n-placeholder="write_question"
                                    ></textarea>
                                    <div class="flex justify-between items-center mt-2">
                                        <p class="text-xs text-slate-500" id="char-count">0 caractere</p>
                                        <p class="text-xs text-red-400 hidden" id="min-chars-error">Minim 5 caractere necesare</p>
                                    </div>
                                </div>
                                
                                <div class="flex gap-3">
                                    <button onclick="document.getElementById('file-upload').click()" class="px-4 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl flex items-center gap-2 transition">
                                        <i class="fa-solid fa-paperclip"></i>
                                        <span class="text-sm">Ata»ôeazƒÉ</span>
                                    </button>
                                    <input type="file" id="file-upload" accept=".txt,.pdf,.doc,.docx" class="hidden">
                                    
                                    <button onclick="clearCronicusChat()" class="px-4 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl flex items-center gap-2 transition">
                                        <i class="fa-solid fa-trash-can"></i>
                                        <span class="text-sm">»òterge</span>
                                    </button>
                                    
                                    <button onclick="askCronicus()" id="ask-cronicus-btn" class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-3 transition">
                                        <i class="fa-solid fa-paper-plane"></i>
                                        <span>TRIMITE √éNTREBAREA</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- LOADING & ERROR STATES -->
                        <div id="cronicus-loading" class="hidden glass rounded-2xl p-6 mb-6">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-blue-600/20 rounded-full flex items-center justify-center">
                                    <i class="fa-solid fa-spinner fa-spin text-blue-400 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-white">CRONICUS proceseazƒÉ...</h3>
                                    <p class="text-sm text-slate-400" id="loading-details">Se genereazƒÉ rƒÉspunsul cu AI</p>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="h-1 bg-slate-800 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-blue-500 to-purple-500 animate-pulse" style="width: 60%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="cronicus-error" class="hidden glass rounded-2xl p-6 mb-6 border border-red-500/30 bg-red-900/10">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-red-600/20 rounded-full flex items-center justify-center">
                                    <i class="fa-solid fa-triangle-exclamation text-red-400 text-xl"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-bold text-white">Eroare CRONICUS</h3>
                                    <p class="text-sm text-slate-300" id="error-message">A apƒÉrut o eroare la procesarea cererii</p>
                                </div>
                                <button onclick="hideError()" class="text-red-400 hover:text-red-300">
                                    <i class="fa-solid fa-xmark text-xl"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- MANUAL -->
                    <div id="v-manual" class="view-content hidden h-full flex-col">
                        <div class="only-prof mb-4">
                            <button onclick="document.getElementById('upload-manual-pdf').click()" class="bg-red-600 text-white text-[10px] font-bold px-4 py-2 rounded-lg" data-i18n="upload_pdf">√éNCARCƒÇ PDF</button>
                            <input type="file" id="upload-manual-pdf" accept=".pdf" style="display:none" onchange="handleManualUpload(this)">
                        </div>
                        <div class="flex-grow bg-[#525659] rounded-2xl p-8 flex flex-col items-center overflow-y-auto shadow-inner">
                            <div class="bg-white w-[600px] min-h-[800px] p-12 text-slate-900 shadow-2xl">
                                <h1 class="text-3xl font-black mb-6" data-i18n="chapter1">Capitolul 1: Antichitatea</h1>
                                <p class="text-justify leading-relaxed" data-i18n="manual_content">Con»õinutul manualului digital...</p>
                            </div>
                        </div>
                    </div>

                    <!-- TEMƒÇ DE ACASƒÇ -->
                    <div id="v-homework" class="view-content hidden h-full flex-col">
                        <div class="glass p-8 rounded-[2rem] max-w-4xl mx-auto w-full relative">
                            <div class="only-prof absolute top-6 right-8">
                                <button onclick="editHomework()" class="bg-red-600 text-white text-[10px] font-bold px-4 py-2 rounded-xl shadow-lg" data-i18n="edit_requirement">EDITEAZƒÇ CERIN»öA</button>
                            </div>
                            
                            <h2 class="text-3xl font-black text-white mb-2" data-i18n="homework">Tema de AcasƒÉ</h2>
                            <p class="text-slate-400 text-xs mb-6" data-i18n="deadline">Termen: Azi, 23:59</p>
                            
                            <div class="bg-slate-900/80 p-6 rounded-3xl border border-slate-700 mb-6">
                                <p class="text-lg text-slate-200 italic" id="hw-req">Analiza»õi importan»õa Nilului.</p>
                            </div>

                            <div class="only-elev flex flex-col gap-4">
                                <textarea id="hw-answer" class="w-full bg-[#0b0f19] border border-slate-800 rounded-3xl p-6 text-sm h-48 focus:border-blue-500 outline-none" placeholder="Rezolvare..." data-i18n-placeholder="solution"></textarea>
                                <div class="flex gap-2">
                                    <button onclick="document.getElementById('hw-file-upload').click()" class="flex-1 bg-slate-700 py-3 rounded-2xl font-bold text-white hover:bg-slate-600 flex items-center justify-center gap-2">
                                        <i class="fa-solid fa-paperclip"></i><span data-i18n="attach_file">ATA»òEAZƒÇ FI»òIER</span>
                                    </button>
                                    <input type="file" id="hw-file-upload" accept=".pdf,.doc,.docx,.ppt,.pptx,.jpg,.jpeg,.png" style="display:none" onchange="handleHomeworkFileUpload(this)">
                                    <button onclick="submitHomework()" class="flex-1 bg-blue-600 py-3 rounded-2xl font-bold text-white shadow-xl hover:bg-blue-500" data-i18n="send">TRIMITE</button>
                                </div>
                                <div id="hw-file-preview" class="text-xs text-slate-400"></div>
                            </div>

                            <!-- VEZI LUCRƒÇRI TRIMISE - PROFESOR -->
                            <div class="only-prof block-mode mt-8">
                                <h3 class="text-lg font-bold text-white mb-4" data-i18n="submitted_works">LucrƒÉri Trimise</h3>
                                <div id="submitted-works" class="space-y-3">
                                    <!-- Va fi populat dinamic -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MATERIALE √éNCƒÇRCATE (NOU) -->
                    <div id="v-uploads" class="view-content hidden h-full flex-col">
                        <div class="max-w-6xl mx-auto w-full">
                            <h2 class="text-2xl font-bold text-white mb-6" data-i18n="materials">Materiale de Curs</h2>
                            
                            <!-- ZONA UPLOAD PROFESOR -->
                            <div class="only-prof block-mode mb-8">
                                <div class="upload-zone rounded-2xl p-8 text-center cursor-pointer" onclick="document.getElementById('material-upload').click()">
                                    <i class="fa-solid fa-cloud-arrow-up text-5xl text-blue-500 mb-4"></i>
                                    <p class="text-white font-bold mb-2" data-i18n="drag_files">Trage fi»ôiere aici sau click pentru a √ÆncƒÉrca</p>
                                    <p class="text-xs text-slate-400" data-i18n="supported_formats">Formate suportate: PDF, PPT, PPTX, DOC, DOCX, JPG, PNG</p>
                                </div>
                                <input type="file" id="material-upload" accept=".pdf,.ppt,.pptx,.doc,.docx,.jpg,.jpeg,.png" multiple style="display:none" onchange="handleMaterialUpload(this)">
                            </div>

                            <!-- LISTƒÇ MATERIALE -->
                            <div id="materials-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <!-- Va fi populat dinamic -->
                            </div>
                        </div>
                    </div>

                    <!-- LEC»öIE ONLINE (NOU) -->
                    <div id="v-online" class="view-content hidden h-full flex-col">
                        <div class="max-w-4xl mx-auto w-full">
                            <h2 class="text-2xl font-bold text-white mb-6" data-i18n="online_lesson">Lec»õie Online</h2>
                            
                            <!-- PANEL PROFESOR -->
                            <div class="only-prof block-mode">
                                <div class="glass p-8 rounded-2xl mb-6">
                                    <h3 class="text-lg font-bold text-white mb-4" data-i18n="create_session">CreeazƒÉ Sesiune Online</h3>
                                    <div class="space-y-4">
                                        <input type="text" id="online-title" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white text-sm" placeholder="Titlu lec»õie..." data-i18n-placeholder="lesson_title">
                                        <textarea id="online-desc" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white text-sm h-24" placeholder="Descriere..." data-i18n-placeholder="description"></textarea>
                                        <button onclick="createOnlineSession()" class="w-full bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-xl" data-i18n="generate_link">GENEREAZƒÇ LINK</button>
                                    </div>
                                </div>

                                <div id="session-info" class="glass p-8 rounded-2xl hidden">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-3 h-3 bg-red-500 rounded-full live-dot"></div>
                                        <h3 class="text-lg font-bold text-white" data-i18n="active_session">Sesiune ActivƒÉ</h3>
                                    </div>
                                    <div class="bg-slate-900 p-4 rounded-xl mb-4">
                                        <p class="text-xs text-slate-400 mb-2" data-i18n="meeting_link">Link √ént√¢lnire:</p>
                                        <div class="flex gap-2">
                                            <input type="text" id="meeting-link" readonly class="flex-1 bg-slate-800 border border-slate-700 rounded-lg p-2 text-white text-sm">
                                            <button onclick="copyLink()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 rounded-lg"><i class="fa-solid fa-copy"></i></button>
                                        </div>
                                    </div>
                                    <button onclick="endSession()" class="w-full bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 rounded-xl" data-i18n="end_session">√éNCHIDE SESIUNE</button>
                                </div>
                            </div>

                            <!-- PANEL ELEV -->
                            <div class="only-elev block-mode">
                                <div id="no-session" class="glass p-12 rounded-2xl text-center">
                                    <i class="fa-solid fa-video-slash text-6xl text-slate-600 mb-4"></i>
                                    <p class="text-slate-400" data-i18n="no_active_session">Nicio sesiune online activƒÉ momentan</p>
                                </div>

                                <div id="active-session" class="glass p-8 rounded-2xl hidden">
                                    <div class="flex items-center gap-3 mb-6">
                                        <div class="w-3 h-3 bg-green-500 rounded-full live-dot"></div>
                                        <h3 class="text-lg font-bold text-white" id="session-title-display">Lec»õia de istorie</h3>
                                    </div>
                                    <p class="text-slate-300 mb-6" id="session-desc-display">Descriere lec»õie...</p>
                                    <button onclick="joinSession()" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-xl text-lg flex items-center justify-center gap-3">
                                        <i class="fa-solid fa-video"></i><span data-i18n="join_lesson">INTRƒÇ √éN LEC»öIE</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- EVALUARE FORMATIVƒÇ (NOU) -->
                    <div id="v-quiz" class="view-content hidden h-full flex-col">
                        <div class="max-w-4xl mx-auto w-full">
                            <!-- PANEL PROFESOR -->
                            <div class="only-prof block-mode">
                                <h2 class="text-2xl font-bold text-white mb-6" data-i18n="formative_assessment">Evaluare FormativƒÉ</h2>
                                
                                <div class="glass p-8 rounded-2xl mb-6">
                                    <h3 class="text-lg font-bold text-white mb-4" data-i18n="create_quiz">CreeazƒÉ Evaluare</h3>
                                    <div class="space-y-4">
                                        <input type="text" id="quiz-title" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white text-sm" placeholder="Titlu evaluare..." data-i18n-placeholder="quiz_title">
                                        <div class="flex gap-4">
                                            <div class="flex-1">
                                                <label class="text-xs text-slate-400 mb-2 block" data-i18n="time_minutes">Timp (minute):</label>
                                                <input type="number" id="quiz-time" value="5" min="1" max="60" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white text-sm">
                                            </div>
                                            <div class="flex-1">
                                                <label class="text-xs text-slate-400 mb-2 block" data-i18n="questions_count">NumƒÉr √ÆntrebƒÉri:</label>
                                                <input type="number" id="quiz-questions" value="3" min="1" max="20" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white text-sm">
                                            </div>
                                        </div>
                                        <textarea id="quiz-questions-text" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white text-sm h-32" placeholder="√éntrebƒÉrile (una per linie)..." data-i18n-placeholder="questions_per_line"></textarea>
                                        <button onclick="startQuiz()" class="w-full bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-xl" data-i18n="start_quiz">PORNE»òTE EVALUARE</button>
                                    </div>
                                </div>

                                <!-- REZULTATE EVALUARE -->
                                <div id="quiz-results" class="glass p-8 rounded-2xl hidden">
                                    <h3 class="text-lg font-bold text-white mb-4" data-i18n="quiz_results">Rezultate Evaluare</h3>
                                    <div id="results-list" class="space-y-3">
                                        <!-- Va fi populat dinamic -->
                                    </div>
                                    <button onclick="analyzeWithAI()" class="w-full mt-4 bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2">
                                        <i class="fa-solid fa-wand-magic-sparkles"></i><span data-i18n="ai_analyze">ANALIZEAZƒÇ CU AI</span>
                                    </button>
                                </div>

                                <!-- VERIFICARE OCR (NOU) -->
                                <div class="glass p-8 rounded-2xl mt-6">
                                    <h3 class="text-lg font-bold text-white mb-4" data-i18n="ocr_check">Verificare OCR (Fotografii)</h3>
                                    <div class="upload-zone rounded-xl p-6 text-center cursor-pointer" onclick="document.getElementById('ocr-upload').click()">
                                        <i class="fa-solid fa-camera text-4xl text-purple-500 mb-3"></i>
                                        <p class="text-white font-bold mb-1" data-i18n="upload_photo">√éncarcƒÉ fotografie evaluare</p>
                                        <p class="text-xs text-slate-400" data-i18n="ocr_formats">Format: JPG, PNG</p>
                                    </div>
                                    <input type="file" id="ocr-upload" accept="image/*" style="display:none" onchange="handleOCRUpload(this)">
                                    <div id="ocr-preview" class="mt-4 hidden">
                                        <img id="ocr-image" class="w-full rounded-xl mb-4">
                                        <button onclick="processOCR()" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 rounded-xl" data-i18n="process_ocr">PROCESEAZƒÇ CU AI</button>
                                    </div>
                                    <div id="ocr-result" class="mt-4 hidden bg-slate-900 p-6 rounded-xl">
                                        <h4 class="text-sm font-bold text-white mb-3" data-i18n="extracted_text">Text Extras:</h4>
                                        <div id="ocr-text" class="text-sm text-slate-300 mb-4"></div>
                                        <div class="bg-blue-900/20 border border-blue-500/30 p-4 rounded-lg">
                                            <h5 class="text-xs font-bold text-blue-400 mb-2" data-i18n="ai_feedback">Feedback AI:</h5>
                                            <p id="ocr-feedback" class="text-sm text-slate-300"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- PANEL ELEV -->
                            <div class="only-elev block-mode">
                                <div id="no-quiz" class="glass p-12 rounded-2xl text-center">
                                    <i class="fa-solid fa-clipboard-question text-6xl text-slate-600 mb-4"></i>
                                    <p class="text-slate-400" data-i18n="no_active_quiz">Nicio evaluare activƒÉ momentan</p>
                                </div>

                                <div id="active-quiz" class="glass p-8 rounded-2xl hidden">
                                    <div class="flex justify-between items-center mb-6">
                                        <h2 class="text-2xl font-bold text-white" id="quiz-title-display">Evaluare FormativƒÉ</h2>
                                        <div class="flex items-center gap-2 bg-red-900/20 border border-red-500/30 px-4 py-2 rounded-xl">
                                            <i class="fa-solid fa-clock text-red-400"></i>
                                            <span id="quiz-timer" class="text-xl font-bold text-red-400">05:00</span>
                                        </div>
                                    </div>

                                    <div id="quiz-questions-display" class="space-y-6 mb-6">
                                        <!-- √éntrebƒÉrile vor fi populate dinamic -->
                                    </div>

                                    <button onclick="submitQuiz()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl" data-i18n="submit_quiz">TRIMITE RƒÇSPUNSURI</button>
                                    
                                    <div id="quiz-submitted" class="hidden mt-6 bg-green-900/20 border border-green-500/30 p-6 rounded-xl text-center">
                                        <i class="fa-solid fa-check-circle text-4xl text-green-400 mb-3"></i>
                                        <p class="text-white font-bold" data-i18n="quiz_submitted_msg">RƒÉspunsurile au fost trimise cu succes!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </section>

            <aside class="w-80 bg-[#0b0f19] border-l border-slate-800 flex flex-col z-10">
                <div class="p-5 font-bold text-white text-xs uppercase border-b border-slate-800 tracking-widest" data-i18n="ai_resources">Resurse AI</div>
                <div class="p-5 space-y-6 overflow-y-auto">
                    <div class="bg-slate-800/40 p-4 rounded-2xl border border-slate-700">
                        <h4 class="text-[10px] font-bold text-blue-400 uppercase mb-2" data-i18n="event_of_day">Evenimentul Zilei</h4>
                        <p class="text-xs text-slate-300">1475: Podul √énalt</p>
                    </div>
                    <div class="bg-slate-800/40 p-4 rounded-2xl border border-slate-700">
                        <h4 class="text-[10px] font-bold text-purple-400 uppercase mb-2" data-i18n="dictionary">Dic»õionar</h4>
                        <input type="text" class="w-full bg-slate-900 border border-slate-600 rounded p-1 text-xs text-white" placeholder="CautƒÉ..." data-i18n-placeholder="search">
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- MODAL ADAUGƒÇ ELEV -->
    <div id="modal-add" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-[2000] modal-overlay">
        <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 w-80">
            <h3 class="text-white font-bold mb-4" data-i18n="enroll_student">√énscrie Elev</h3>
            <input type="text" id="new-name" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white text-sm mb-4" placeholder="Nume Prenume" data-i18n-placeholder="full_name">
            <div class="flex gap-2">
                <button onclick="closeModal()" class="flex-1 bg-slate-700 text-white text-xs py-2 rounded" data-i18n="cancel">AnuleazƒÉ</button>
                <button onclick="addStudent()" class="flex-1 bg-blue-600 text-white text-xs py-2 rounded font-bold" data-i18n="save">SalveazƒÉ</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // TRADUCERI BILINGV RO/RU
        // ============================================
        const translations = {
            RO: {
                welcome: "BINE AI VENIT!",
                pdld: "PLAN CADRU",
                today_topic: "TEMA LEC»öIEI DE AZI",
                publish: "PUBLICƒÇ",
                go: "MERGI LA LEC»öIE",
                control_panel: "PANOU CONTROL",
                mentor: "MENTOR",
                manual: "MANUAL",
                homework_tab: "TEMƒÇ",
                uploads: "MATERIALE",
                online_lesson: "LEC»öIE ONLINE",
                quiz: "EVALUARE",
                register: "Registru Clasa",
                add_student: "√éNSCRIE ELEV",
                name: "Nume",
                grades: "Note",
                absences: "Absen»õe",
                notes: "Note/Obs",
                mentor_greeting: "Salut! Sunt Cronicus. DiscutƒÉm despre istorie?",
                write: "Scrie...",
                upload_pdf: "√éNCARCƒÇ PDF",
                chapter1: "Capitolul 1: Antichitatea",
                manual_content: "Con»õinutul manualului digital...",
                homework: "Tema de AcasƒÉ",
                deadline: "Termen: Azi, 23:59",
                edit_requirement: "EDITEAZƒÇ CERIN»öA",
                solution: "Rezolvare...",
                attach_file: "ATA»òEAZƒÇ FI»òIER",
                send: "TRIMITE",
                submitted_works: "LucrƒÉri Trimise",
                materials: "Materiale de Curs",
                drag_files: "Trage fi»ôiere aici sau click pentru a √ÆncƒÉrca",
                supported_formats: "Formate suportate: PDF, PPT, PPTX, DOC, DOCX, JPG, PNG",
                create_session: "CreeazƒÉ Sesiune Online",
                lesson_title: "Titlu lec»õie...",
                description: "Descriere...",
                generate_link: "GENEREAZƒÇ LINK",
                active_session: "Sesiune ActivƒÉ",
                meeting_link: "Link √ént√¢lnire:",
                end_session: "√éNCHIDE SESIUNE",
                no_active_session: "Nicio sesiune online activƒÉ momentan",
                join_lesson: "INTRƒÇ √éN LEC»öIE",
                formative_assessment: "Evaluare FormativƒÉ",
                create_quiz: "CreeazƒÉ Evaluare",
                quiz_title: "Titlu evaluare...",
                time_minutes: "Timp (minute):",
                questions_count: "NumƒÉr √ÆntrebƒÉri:",
                questions_per_line: "√éntrebƒÉrile (una per linie)...",
                start_quiz: "PORNE»òTE EVALUARE",
                quiz_results: "Rezultate Evaluare",
                ai_analyze: "ANALIZEAZƒÇ CU AI",
                ocr_check: "Verificare OCR (Fotografii)",
                upload_photo: "√éncarcƒÉ fotografie evaluare",
                ocr_formats: "Format: JPG, PNG",
                process_ocr: "PROCESEAZƒÇ CU AI",
                extracted_text: "Text Extras:",
                ai_feedback: "Feedback AI:",
                no_active_quiz: "Nicio evaluare activƒÉ momentan",
                submit_quiz: "TRIMITE RƒÇSPUNSURI",
                quiz_submitted_msg: "RƒÉspunsurile au fost trimise cu succes!",
                ai_resources: "Resurse AI",
                event_of_day: "Evenimentul Zilei",
                dictionary: "Dic»õionar",
                search: "CautƒÉ...",
                enroll_student: "√énscrie Elev",
                full_name: "Nume Prenume",
                cancel: "AnuleazƒÉ",
                save: "SalveazƒÉ",
                mode_fast: "RƒÇSPUNS RAPID",
                mode_deep: "ANALIZƒÇ PROFUNDƒÇ",
                write_question: "Scrie √Æntrebarea ta de istorie sau √ÆncarcƒÉ un eseu pentru evaluare BAC..."
            },
            RU: {
                welcome: "–î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨!",
                pdld: "–£–ß–ï–ë–ù–´–ô –ü–õ–ê–ù",
                today_topic: "–¢–ï–ú–ê –°–ï–ì–û–î–ù–Ø–®–ù–ï–ì–û –£–†–û–ö–ê",
                publish: "–û–ü–£–ë–õ–ò–ö–û–í–ê–¢–¨",
                go: "–ü–ï–†–ï–ô–¢–ò –ö –£–†–û–ö–£",
                control_panel: "–ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø",
                mentor: "–ú–ï–ù–¢–û–†",
                manual: "–£–ß–ï–ë–ù–ò–ö",
                homework_tab: "–ó–ê–î–ê–ù–ò–ï",
                uploads: "–ú–ê–¢–ï–†–ò–ê–õ–´",
                online_lesson: "–û–ù–õ–ê–ô–ù –£–†–û–ö",
                quiz: "–û–¶–ï–ù–ò–í–ê–ù–ò–ï",
                register: "–ñ—É—Ä–Ω–∞–ª –ö–ª–∞—Å—Å",
                add_student: "–ó–ê–ü–ò–°–ê–¢–¨ –£–ß–ï–ù–ò–ö–ê",
                name: "–ò–º—è",
                grades: "–û—Ü–µ–Ω–∫–∏",
                absences: "–û—Ç—Å—É—Ç—Å—Ç–≤–∏—è",
                notes: "–ó–∞–º–µ—Ç–∫–∏/–ù–∞–±–ª.",
                mentor_greeting: "–ü—Ä–∏–≤–µ—Ç! –Ø Cronicus. –û–±—Å—É–¥–∏–º –∏—Å—Ç–æ—Ä–∏—é?",
                write: "–ù–∞–ø–∏—à–∏...",
                upload_pdf: "–ó–ê–ì–†–£–ó–ò–¢–¨ PDF",
                chapter1: "–ì–ª–∞–≤–∞ 1: –î—Ä–µ–≤–Ω–æ—Å—Ç—å",
                manual_content: "–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ —É—á–µ–±–Ω–∏–∫–∞...",
                homework: "–î–æ–º–∞—à–Ω–µ–µ –ó–∞–¥–∞–Ω–∏–µ",
                deadline: "–°—Ä–æ–∫: –°–µ–≥–æ–¥–Ω—è, 23:59",
                edit_requirement: "–†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨ –¢–†–ï–ë–û–í–ê–ù–ò–ï",
                solution: "–†–µ—à–µ–Ω–∏–µ...",
                attach_file: "–ü–†–ò–ö–†–ï–ü–ò–¢–¨ –§–ê–ô–õ",
                send: "–û–¢–ü–†–ê–í–ò–¢–¨",
                submitted_works: "–°–¥–∞–Ω–Ω—ã–µ –†–∞–±–æ—Ç—ã",
                materials: "–£—á–µ–±–Ω—ã–µ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã",
                drag_files: "–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏",
                supported_formats: "–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PDF, PPT, PPTX, DOC, DOCX, JPG, PNG",
                create_session: "–°–æ–∑–¥–∞—Ç—å –û–Ω–ª–∞–π–Ω –°–µ—Å—Å–∏—é",
                lesson_title: "–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞...",
                description: "–û–ø–∏—Å–∞–Ω–∏–µ...",
                generate_link: "–°–û–ó–î–ê–¢–¨ –°–°–´–õ–ö–£",
                active_session: "–ê–∫—Ç–∏–≤–Ω–∞—è –°–µ—Å—Å–∏—è",
                meeting_link: "–°—Å—ã–ª–∫–∞ –í—Å—Ç—Ä–µ—á–∏:",
                end_session: "–ó–ê–ö–†–´–¢–¨ –°–ï–°–°–ò–Æ",
                no_active_session: "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –æ–Ω–ª–∞–π–Ω —Å–µ—Å—Å–∏–∏",
                join_lesson: "–í–û–ô–¢–ò –í –£–†–û–ö",
                formative_assessment: "–§–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ –û—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ",
                create_quiz: "–°–æ–∑–¥–∞—Ç—å –û—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ",
                quiz_title: "–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è...",
                time_minutes: "–í—Ä–µ–º—è (–º–∏–Ω—É—Ç—ã):",
                questions_count: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤:",
                questions_per_line: "–í–æ–ø—Ä–æ—Å—ã (–æ–¥–∏–Ω –Ω–∞ —Å—Ç—Ä–æ–∫—É)...",
                start_quiz: "–ù–ê–ß–ê–¢–¨ –û–¶–ï–ù–ò–í–ê–ù–ò–ï",
                quiz_results: "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –û—Ü–µ–Ω–∏–≤–∞–Ω–∏—è",
                ai_analyze: "–ê–ù–ê–õ–ò–ó–ò–†–û–í–ê–¢–¨ –° AI",
                ocr_check: "–ü—Ä–æ–≤–µ—Ä–∫–∞ OCR (–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏)",
                upload_photo: "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è",
                ocr_formats: "–§–æ—Ä–º–∞—Ç: JPG, PNG",
                process_ocr: "–û–ë–†–ê–ë–û–¢–ê–¢–¨ –° AI",
                extracted_text: "–ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π –¢–µ–∫—Å—Ç:",
                ai_feedback: "–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å AI:",
                no_active_quiz: "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è",
                submit_quiz: "–û–¢–ü–†–ê–í–ò–¢–¨ –û–¢–í–ï–¢–´",
                quiz_submitted_msg: "–û—Ç–≤–µ—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!",
                ai_resources: "AI –†–µ—Å—É—Ä—Å—ã",
                event_of_day: "–°–æ–±—ã—Ç–∏–µ –î–Ω—è",
                dictionary: "–°–ª–æ–≤–∞—Ä—å",
                search: "–ü–æ–∏—Å–∫...",
                enroll_student: "–ó–∞–ø–∏—Å–∞—Ç—å –£—á–µ–Ω–∏–∫–∞",
                full_name: "–ò–º—è –§–∞–º–∏–ª–∏—è",
                cancel: "–û—Ç–º–µ–Ω–∏—Ç—å",
                save: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
                mode_fast: "–ë–´–°–¢–†–´–ô –û–¢–í–ï–¢",
                mode_deep: "–ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó",
                write_question: "–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —ç—Å—Å–µ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ BAC..."
            }
        };

        let cL = 'RO';
        let currentRole = null;
        let currentUser = null;
        let currentClass = 'X';
        let quizTimer = null;
        let uploadedFiles = [];
        let submittedHomework = [];
        let materials = [];
        let onlineSessionActive = false;
        let activeQuiz = null;
        let ocrImage = null;

        // ============================================
        // FUNC»öII DE BAZƒÇ
        // ============================================

      // ============================================
        // CONFIGURARE BACKEND
        // ============================================
        const API_BASE_URL = 'https://history-cosmos.contact-ai.online';

        async function handleAuth(action) {
            const user = document.getElementById('user-input').value;
            const pass = document.getElementById('pass-input').value;
            const msgLabel = document.getElementById('login-msg');

            if (!user || !pass) {
                if(msgLabel) msgLabel.innerText = "Introdu user »ôi parolƒÉ!";
                else alert("Introdu user »ôi parolƒÉ!");
                return;
            }

            let fullName = null;
            if (action === 'register') {
                fullName = prompt("Introdu numele tƒÉu complet (ex: Mihai Eminescu):");
                if (!fullName) return;
            }

            if(msgLabel) {
                msgLabel.innerText = "Conectare...";
                msgLabel.className = "text-xs text-blue-400 mt-4 h-4 animate-pulse";
            }

            try {
                const response = await fetch(`${API_BASE_URL}/${action}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        username: user, 
                        password: pass, 
                        fullname: fullName 
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    if (action === 'register') {
                        alert("Cont creat! A»ôteaptƒÉ aprobarea profesorului.");
                        if(msgLabel) msgLabel.innerText = "Cont creat. A»ôteaptƒÉ aprobarea.";
                    } else {
                        // LOGIN REU»òIT -> Pornim interfa»õa ta originalƒÉ
                        localStorage.setItem('userSession', JSON.stringify(data.user));
                        
                        // AICI FOLOSIM FUNC»öIA TA VECHE 'start'
                        start(
                            data.user.role, 
                            data.user.fullname || data.user.username, 
                            data.user.role === 'teacher' ? 'ADMIN' : 'ELEV'
                        );
                    }
                } else {
                    const errMsg = data.error || "Eroare necunoscutƒÉ";
                    if(msgLabel) {
                        msgLabel.innerText = errMsg;
                        msgLabel.className = "text-xs text-red-500 mt-4 h-4 font-bold";
                    } else {
                        alert(errMsg);
                    }
                }
            } catch (err) {
                console.error(err);
                if(msgLabel) msgLabel.innerText = "Eroare conexiune server!";
                else alert("Eroare conexiune server!");
            }
        }

        function start(role, name, lbl) {
            currentRole = role;
            currentUser = name;
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-screen').style.display = 'flex';
            document.body.className = "h-screen flex flex-col overflow-hidden is-" + role;
            document.getElementById('u-name').innerText = name;
            document.getElementById('u-role').innerText = lbl;
            document.getElementById('u-role').className = role === 'teacher' ? "text-[10px] font-bold text-red-500" : "text-[10px] font-bold text-blue-500";
            
            nav(role === 'teacher' ? 'admin' : 'mentor');
            
            const d = new Date();
            document.getElementById('date-txt').innerText = d.toLocaleDateString('ro-RO');

            // Simulare materiale »ôi sesiuni pentru demo
            if(role === 'teacher') {
                initTeacherData();
            } else {
                initStudentData();
            }
        }

        function nav(id) {
            document.querySelectorAll('.view-content').forEach(v => v.style.display = 'none');
            const target = document.getElementById('v-' + id);
            target.style.display = (id === 'mentor' || id === 'manual' || id === 'admin' || id === 'homework' || id === 'uploads' || id === 'online' || id === 'quiz') ? 'flex' : 'block';
            
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            const btn = document.getElementById('t-' + id);
            if(btn) btn.classList.add('active');
        }

        function pubTopic() {
            const t = document.getElementById('topic-edit').value;
            document.getElementById('topic-view').innerText = t;
            document.getElementById('hw-req').innerText = "Cerin»õƒÉ: " + t;
            showNotification(cL === 'RO' ? 'Publicat cu succes!' : '–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ!');
        }

        function changeLang() {
            cL = cL === 'RO' ? 'RU' : 'RO';
            document.getElementById('lang-ind').innerText = cL;
            applyTranslations();
        }

        function applyTranslations() {
            const t = translations[cL];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(t[key]) el.innerText = t[key];
            });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if(t[key]) el.placeholder = t[key];
            });
            
            // Update curriculum c√¢nd schimbƒÉm limba
            if(currentClass) {
                updateCurriculumForClass(currentClass);
            }
        }

        function editTxt(el) {
            let n = prompt(cL === 'RO' ? "EditeazƒÉ:" : "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:", el.innerText);
            if(n) el.querySelector('span').innerText = n;
        }

        function openModal() { document.getElementById('modal-add').style.display = 'flex'; }
        function closeModal() { document.getElementById('modal-add').style.display = 'none'; }
        
        function addStudent() {
            const n = document.getElementById('new-name').value;
            if(n) {
                const tb = document.querySelector('#reg-table tbody');
                tb.innerHTML += `<tr class="border-b border-slate-800 hover:bg-slate-800/30"><td class="p-2 font-bold text-white">${n}</td><td class="p-2 text-center"><input type="text" class="t-input" placeholder="-"></td><td class="p-2 text-center"><input type="text" class="t-input text-red-400" placeholder="-"></td><td class="p-2"><input type="text" class="t-input text-left" placeholder="..."></td></tr>`;
                closeModal();
                showNotification(cL === 'RO' ? 'Elev adƒÉugat!' : '–£—á–µ–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω!');
            }
        }

        function showNotification(msg) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-6 bg-green-600 text-white px-6 py-3 rounded-xl shadow-2xl z-[9999] font-bold text-sm';
            notification.innerText = msg;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // ============================================
        // SCHIMBAREA CLASEI (X, XI, XII)
        // ============================================

        function changeClass(classNum) {
            currentClass = classNum;
            
            // Update visual: toggle active state
            ['X', 'XI', 'XII'].forEach(c => {
                const btn = document.getElementById('class-' + c);
                if(c === classNum) {
                    btn.classList.remove('text-slate-500');
                    btn.classList.add('bg-blue-600', 'text-white');
                } else {
                    btn.classList.remove('bg-blue-600', 'text-white');
                    btn.classList.add('text-slate-500');
                }
            });
            
            // Update registru header (X-A, XI-A, XII-A)
            document.getElementById('class-header-display').innerText = classNum + '-A';
            
            // Update plan cadru (aici po»õi √ÆncƒÉrca date specifice clasei)
            updateCurriculumForClass(classNum);
            
            showNotification(cL === 'RO' ? `Schimbat la Clasa ${classNum}` : `–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ –ö–ª–∞—Å—Å ${classNum}`);
        }

        function updateCurriculumForClass(classNum) {
            // Aici po»õi actualiza con»õinutul din sidebar (Plan Cadru)
            // De exemplu, √ÆncƒÉrcare teme specifice pentru fiecare clasƒÉ
            const curriculumData = {
                'X': [
                    { unit: 'U1', title: cL === 'RO' ? 'Orientul Antic' : '–î—Ä–µ–≤–Ω–∏–π –í–æ—Å—Ç–æ–∫' },
                    { unit: 'U2', title: cL === 'RO' ? 'Grecia AnticƒÉ' : '–î—Ä–µ–≤–Ω—è—è –ì—Ä–µ—Ü–∏—è' },
                    { unit: 'U3', title: cL === 'RO' ? 'Roma AnticƒÉ' : '–î—Ä–µ–≤–Ω–∏–π –†–∏–º' },
                    { unit: 'U4', title: cL === 'RO' ? 'Evul Mediu European' : '–ï–≤—Ä–æ–ø–µ–π—Å–∫–æ–µ –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å–µ' },
                    { unit: 'U5', title: cL === 'RO' ? 'Rena»ôterea »ôi Umanismul' : '–í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ –∏ –ì—É–º–∞–Ω–∏–∑–º' },
                    { unit: 'U6', title: cL === 'RO' ? 'Marile Descoperiri Geografice' : '–í–µ–ª–∏–∫–∏–µ –ì–µ–æ–≥—Ä–∞—Ñ. –û—Ç–∫—Ä—ã—Ç–∏—è' }
                ],
                'XI': [
                    { unit: 'U1', title: cL === 'RO' ? '1640-1789: Absolutism & Revolu»õii' : '1640-1789: –ê–±—Å–æ–ª—é—Ç–∏–∑–º & –†–µ–≤–æ–ª—é—Ü–∏–∏' },
                    { unit: 'U2', title: cL === 'RO' ? '1789-1870: Revolu»õii Na»õionale' : '1789-1870: –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –†–µ–≤–æ–ª—é—Ü–∏–∏' },
                    { unit: 'U3', title: cL === 'RO' ? '1870-1914/1918: Imperialism & WWI' : '1870-1914/1918: –ò–º–ø–µ—Ä–∏–∞–ª–∏–∑–º & –ü–ú–í' }
                ],
                'XII': [
                    { unit: 'U1', title: cL === 'RO' ? '1918-1939: InterbelicƒÉ & Totalitarisme' : '1918-1939: –ú–µ–∂–≤–æ–µ–Ω–Ω—ã–π & –¢–æ—Ç–∞–ª–∏—Ç–∞—Ä–∏–∑–º' },
                    { unit: 'U2', title: cL === 'RO' ? '1939-1945: Al Doilea RƒÉzboi Mondial' : '1939-1945: –í—Ç–æ—Ä–∞—è –ú–∏—Ä–æ–≤–∞—è –í–æ–π–Ω–∞' },
                    { unit: 'U3', title: cL === 'RO' ? '1945-2026: RƒÉzboi Rece & Contemporan' : '1945-2026: –•–æ–ª–æ–¥–Ω–∞—è –í–æ–π–Ω–∞ & –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å' }
                ]
            };
            
            const curriculumContainer = document.querySelector('aside .flex-grow.overflow-y-auto');
            const units = curriculumData[classNum];
            
            curriculumContainer.innerHTML = units.map(u => `
                <div class="bg-blue-900/20 border border-blue-500/30 p-3 rounded-lg">
                    <p class="text-[9px] text-blue-300 font-bold mb-1 opacity-70">${u.unit}</p>
                    <p class="text-xs text-white font-bold leading-tight">${u.title}</p>
                </div>
            `).join('');
        }

        function editHomework() {
            const newReq = prompt(cL === 'RO' ? 'EditeazƒÉ cerin»õa:' : '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ:', document.getElementById('hw-req').innerText);
            if(newReq) {
                document.getElementById('hw-req').innerText = newReq;
                showNotification(cL === 'RO' ? 'Cerin»õƒÉ actualizatƒÉ!' : '–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!');
            }
        }

        // ============================================
        // UPLOAD MATERIALE
        // ============================================

        function handleMaterialUpload(input) {
            const files = Array.from(input.files);
            files.forEach(file => {
                materials.push({
                    name: file.name,
                    size: (file.size / 1024).toFixed(2) + ' KB',
                    type: file.type,
                    uploadedBy: currentUser,
                    date: new Date().toLocaleDateString('ro-RO')
                });
            });
            renderMaterials();
            showNotification(cL === 'RO' ? `${files.length} fi»ôier(e) √ÆncƒÉrcat(e)!` : `${files.length} —Ñ–∞–π–ª(–æ–≤) –∑–∞–≥—Ä—É–∂–µ–Ω–æ!`);
        }

        function renderMaterials() {
            const container = document.getElementById('materials-list');
            if(materials.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center text-slate-400 py-12"><i class="fa-solid fa-folder-open text-5xl mb-4 opacity-50"></i><p>${cL === 'RO' ? 'Niciun material √ÆncƒÉrcat' : '–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤'}</p></div>`;
                return;
            }

            container.innerHTML = materials.map((m, i) => `
                <div class="file-item p-4 rounded-xl">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                                <i class="fa-solid ${getFileIcon(m.type)} text-white"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-bold text-white truncate">${m.name}</p>
                                <p class="text-xs text-slate-400">${m.size}</p>
                            </div>
                        </div>
                        ${currentRole === 'teacher' ? `<button onclick="deleteMaterial(${i})" class="text-red-400 hover:text-red-300"><i class="fa-solid fa-trash-can"></i></button>` : ''}
                    </div>
                    <div class="text-xs text-slate-500 flex items-center justify-between">
                        <span><i class="fa-solid fa-user mr-1"></i>${m.uploadedBy}</span>
                        <span><i class="fa-solid fa-calendar mr-1"></i>${m.date}</span>
                    </div>
                    <button onclick="downloadMaterial(${i})" class="w-full mt-3 bg-slate-700 hover:bg-slate-600 text-white text-xs font-bold py-2 rounded-lg">
                        <i class="fa-solid fa-download mr-2"></i>${cL === 'RO' ? 'DESCARCƒÇ' : '–°–ö–ê–ß–ê–¢–¨'}
                    </button>
                </div>
            `).join('');
        }

        function getFileIcon(type) {
            if(type.includes('pdf')) return 'fa-file-pdf';
            if(type.includes('presentation') || type.includes('powerpoint')) return 'fa-file-powerpoint';
            if(type.includes('word') || type.includes('document')) return 'fa-file-word';
            if(type.includes('image')) return 'fa-file-image';
            return 'fa-file';
        }

        function deleteMaterial(index) {
            if(confirm(cL === 'RO' ? 'Sigur »ôtergi?' : '–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å?')) {
                materials.splice(index, 1);
                renderMaterials();
                showNotification(cL === 'RO' ? 'Material »ôters!' : '–ú–∞—Ç–µ—Ä–∏–∞–ª —É–¥–∞–ª–µ–Ω!');
            }
        }

        function downloadMaterial(index) {
            showNotification(cL === 'RO' ? 'Se descarcƒÉ...' : '–ó–∞–≥—Ä—É–∑–∫–∞...');
        }

        function handleManualUpload(input) {
            if(input.files.length > 0) {
                showNotification(cL === 'RO' ? 'Manual √ÆncƒÉrcat cu succes!' : '–£—á–µ–±–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!');
            }
        }

        // ============================================
        // TEMƒÇ DE ACASƒÇ - UPLOAD & VERIFICARE AI
        // ============================================

        function handleHomeworkFileUpload(input) {
            if(input.files.length > 0) {
                const file = input.files[0];
                document.getElementById('hw-file-preview').innerText = `üìé ${file.name} (${(file.size/1024).toFixed(2)} KB)`;
                uploadedFiles.push(file);
            }
        }

        function submitHomework() {
            const answer = document.getElementById('hw-answer').value;
            if(!answer && uploadedFiles.length === 0) {
                alert(cL === 'RO' ? 'CompleteazƒÉ rƒÉspunsul sau ata»ôeazƒÉ fi»ôier!' : '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ—Ç–≤–µ—Ç –∏–ª–∏ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–∞–π–ª!');
                return;
            }

            submittedHomework.push({
                student: currentUser,
                answer: answer,
                files: [...uploadedFiles],
                date: new Date().toLocaleString('ro-RO')
            });

            showNotification(cL === 'RO' ? 'TemƒÉ trimisƒÉ cu succes!' : '–ó–∞–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
            document.getElementById('hw-answer').value = '';
            document.getElementById('hw-file-preview').innerText = '';
            uploadedFiles = [];

            // Notificare profesor (simulare)
            if(currentRole === 'teacher') {
                renderSubmittedWorks();
            }
        }

        function renderSubmittedWorks() {
            const container = document.getElementById('submitted-works');
            if(submittedHomework.length === 0) {
                container.innerHTML = `<p class="text-slate-400 text-sm">${cL === 'RO' ? 'Nicio lucrare trimisƒÉ √ÆncƒÉ' : '–ù–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç'}</p>`;
                return;
            }

            container.innerHTML = submittedHomework.map((hw, i) => `
                <div class="file-item p-4 rounded-xl">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <p class="text-sm font-bold text-white">${hw.student}</p>
                            <p class="text-xs text-slate-400">${hw.date}</p>
                        </div>
                        <button onclick="verifyWithAI(${i})" class="bg-purple-600 hover:bg-purple-500 text-white text-xs font-bold px-3 py-1.5 rounded-lg flex items-center gap-2">
                            <i class="fa-solid fa-wand-magic-sparkles"></i>${cL === 'RO' ? 'VERIFICƒÇ AI' : '–ü–†–û–í–ï–†–ò–¢–¨ AI'}
                        </button>
                    </div>
                    <div class="bg-slate-900 p-3 rounded-lg text-xs text-slate-300 mb-2">
                        ${hw.answer || `<span class="text-slate-500">${cL === 'RO' ? 'FƒÉrƒÉ text (doar fi»ôiere)' : '–ë–µ–∑ —Ç–µ–∫—Å—Ç–∞ (—Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã)'}</span>`}
                    </div>
                    ${hw.files.length > 0 ? `<p class="text-xs text-blue-400"><i class="fa-solid fa-paperclip mr-1"></i>${hw.files.length} ${cL === 'RO' ? 'fi»ôier(e) ata»ôat(e)' : '—Ñ–∞–π–ª(–æ–≤) –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ'}</p>` : ''}
                </div>
            `).join('');
        }

        async function verifyWithAI(index) {
            const hw = submittedHomework[index];
            
            // Afi»ôeazƒÉ loading
            showNotification(cL === 'RO' ? 'Se analizeazƒÉ cu AI...' : '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å AI...');
            
            try {
                // Apel REAL cƒÉtre Deepseek/Mistral
                const systemMessage = cL === 'RO' 
                    ? 'E»ôti profesor de istorie pentru elevii de liceu din Moldova. AnalizeazƒÉ rƒÉspunsul elevului »ôi oferƒÉ feedback constructiv cu notƒÉ pe scara 1-10.'
                    : '–í—ã —É—á–∏—Ç–µ–ª—å –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è —Å—Ç–∞—Ä—à–µ–∫–ª–∞—Å—Å–Ω–∏–∫–æ–≤ –∏–∑ –ú–æ–ª–¥–æ–≤—ã. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ—Ç–≤–µ—Ç —É—á–µ–Ω–∏–∫–∞ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å —Å –æ—Ü–µ–Ω–∫–æ–π –ø–æ —à–∫–∞–ª–µ 1-10.';
                
                const prompt = cL === 'RO'
                    ? `AnalizeazƒÉ urmƒÉtorul rƒÉspuns al elevului »ôi oferƒÉ feedback detaliat:\n\n"${hw.answer || hw.files.join(', ')}"\n\nNotƒÉ: OferƒÉ o evaluare obiectivƒÉ pe baza claritƒÉ»õii, exactitƒÉ»õii »ôi argumentƒÉrii.`
                    : `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –æ—Ç–≤–µ—Ç —É—á–µ–Ω–∏–∫–∞ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å:\n\n"${hw.answer || hw.files.join(', ')}"\n\n–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –î–∞–π—Ç–µ –æ–±—ä–µ–∫—Ç–∏–≤–Ω—É—é –æ—Ü–µ–Ω–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–µ —è—Å–Ω–æ—Å—Ç–∏, —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏–∏.`;
                
                const feedback = await callAIProvider(prompt, systemMessage);
                
                alert(`ü§ñ AI Feedback (${AI_CONFIG.provider.toUpperCase()}):\n\n${feedback}`);
                
            } catch (error) {
                console.error('Eroare verificare AI:', error);
                const fallbackFeedback = generateSimulatedResponse(hw.answer);
                alert(`AI Feedback (Simulat):\n\n${fallbackFeedback}`);
            }
        }

        // ============================================
        // LEC»öIE ONLINE
        // ============================================

        function createOnlineSession() {
            const title = document.getElementById('online-title').value;
            const desc = document.getElementById('online-desc').value;
            
            if(!title) {
                alert(cL === 'RO' ? 'CompleteazƒÉ titlul!' : '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ!');
                return;
            }

            const meetingLink = generateMeetingLink();
            document.getElementById('meeting-link').value = meetingLink;
            document.getElementById('session-info').classList.remove('hidden');
            
            onlineSessionActive = true;
            showNotification(cL === 'RO' ? 'Sesiune creatƒÉ! Link copiat.' : '–°–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞! –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞.');

            // Simulare notificare elevi
            if(currentRole === 'student') {
                showStudentSession(title, desc, meetingLink);
            }
        }

        function generateMeetingLink() {
            const id = Math.random().toString(36).substring(2, 11);
            return `https://meet.history-cosmos.ai/${id}`;
        }

        function copyLink() {
            const link = document.getElementById('meeting-link').value;
            navigator.clipboard.writeText(link);
            showNotification(cL === 'RO' ? 'Link copiat!' : '–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
        }

        function endSession() {
            if(confirm(cL === 'RO' ? '√énchizi sesiunea?' : '–ó–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é?')) {
                document.getElementById('session-info').classList.add('hidden');
                onlineSessionActive = false;
                showNotification(cL === 'RO' ? 'Sesiune √ÆnchisƒÉ!' : '–°–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞!');
            }
        }

        function showStudentSession(title, desc, link) {
            document.getElementById('no-session').classList.add('hidden');
            document.getElementById('active-session').classList.remove('hidden');
            document.getElementById('session-title-display').innerText = title;
            document.getElementById('session-desc-display').innerText = desc;
            document.getElementById('active-session').dataset.link = link;
        }

        function joinSession() {
            const link = document.getElementById('active-session').dataset.link;
            if(link) {
                window.open(link, '_blank');
                showNotification(cL === 'RO' ? 'Se deschide lec»õia...' : '–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —É—Ä–æ–∫...');
            }
        }

        // ============================================
        // EVALUARE FORMATIVƒÇ
        // ============================================

        function startQuiz() {
            const title = document.getElementById('quiz-title').value;
            const timeMinutes = parseInt(document.getElementById('quiz-time').value);
            const questionsText = document.getElementById('quiz-questions-text').value;
            
            if(!title || !questionsText) {
                alert(cL === 'RO' ? 'CompleteazƒÉ toate c√¢mpurile!' : '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            const questions = questionsText.split('\n').filter(q => q.trim());
            
            activeQuiz = {
                title: title,
                time: timeMinutes,
                questions: questions,
                answers: [],
                startTime: Date.now()
            };

            showNotification(cL === 'RO' ? 'Evaluare pornitƒÉ!' : '–û—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ –Ω–∞—á–∞—Ç–æ!');
            
            // Pentru elevi - aratƒÉ quiz-ul
            if(currentRole === 'student') {
                displayQuizForStudent();
            }
        }

        function displayQuizForStudent() {
            document.getElementById('no-quiz').classList.add('hidden');
            document.getElementById('active-quiz').classList.remove('hidden');
            document.getElementById('quiz-title-display').innerText = activeQuiz.title;
            
            const questionsContainer = document.getElementById('quiz-questions-display');
            questionsContainer.innerHTML = activeQuiz.questions.map((q, i) => `
                <div class="bg-slate-900/50 border border-slate-700 p-4 rounded-xl">
                    <p class="text-sm font-bold text-white mb-3">${i+1}. ${q}</p>
                    <textarea id="quiz-answer-${i}" class="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-sm text-white h-24" placeholder="${cL === 'RO' ? 'RƒÉspunsul tƒÉu...' : '–í–∞—à –æ—Ç–≤–µ—Ç...'}"></textarea>
                </div>
            `).join('');

            startQuizTimer();
        }

        function startQuizTimer() {
            let timeLeft = activeQuiz.time * 60;
            const timerDisplay = document.getElementById('quiz-timer');
            
            quizTimer = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.innerText = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                
                if(timeLeft <= 60) {
                    timerDisplay.classList.add('timer-warning');
                }
                
                if(timeLeft <= 0) {
                    clearInterval(quizTimer);
                    submitQuiz(true);
                }
            }, 1000);
        }

        function submitQuiz(autoSubmit = false) {
            if(!autoSubmit) {
                if(!confirm(cL === 'RO' ? 'Trimi»õi rƒÉspunsurile?' : '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç—ã?')) return;
            }
            
            clearInterval(quizTimer);
            
            activeQuiz.questions.forEach((q, i) => {
                const answer = document.getElementById(`quiz-answer-${i}`).value;
                activeQuiz.answers.push({ question: q, answer: answer });
            });
            
            document.getElementById('quiz-questions-display').innerHTML = '';
            document.getElementById('active-quiz').querySelector('button').classList.add('hidden');
            document.getElementById('quiz-submitted').classList.remove('hidden');
            
            showNotification(cL === 'RO' ? 'RƒÉspunsuri trimise!' : '–û—Ç–≤–µ—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!');
            
            // Pentru profesor - aratƒÉ rezultate
            if(currentRole === 'teacher') {
                displayQuizResults();
            }
        }

        function displayQuizResults() {
            document.getElementById('quiz-results').classList.remove('hidden');
            const resultsContainer = document.getElementById('results-list');
            
            resultsContainer.innerHTML = `
                <div class="file-item p-4 rounded-xl">
                    <div class="flex items-center justify-between mb-3">
                        <p class="text-sm font-bold text-white">${currentUser}</p>
                        <span class="text-xs bg-blue-600 text-white px-3 py-1 rounded-full">${activeQuiz.answers.length} ${cL === 'RO' ? 'rƒÉspunsuri' : '–æ—Ç–≤–µ—Ç–æ–≤'}</span>
                    </div>
                    ${activeQuiz.answers.map((a, i) => `
                        <div class="bg-slate-900 p-3 rounded-lg mb-2">
                            <p class="text-xs font-bold text-slate-400 mb-1">${i+1}. ${a.question}</p>
                            <p class="text-xs text-slate-300">${a.answer || `<span class="text-red-400">${cL === 'RO' ? 'FƒÉrƒÉ rƒÉspuns' : '–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞'}</span>`}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function analyzeWithAI() {
            showNotification(cL === 'RO' ? 'Se analizeazƒÉ cu AI...' : '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å AI...');
            
            try {
                const systemMessage = cL === 'RO'
                    ? 'E»ôti profesor de istorie. AnalizeazƒÉ performan»õa elevului la quiz »ôi oferƒÉ feedback detaliat.'
                    : '–í—ã —É—á–∏—Ç–µ–ª—å –∏—Å—Ç–æ—Ä–∏–∏. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —É—á–µ–Ω–∏–∫–∞ –Ω–∞ —Ç–µ—Å—Ç–µ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å.';
                
                const prompt = cL === 'RO'
                    ? `AnalizeazƒÉ urmƒÉtoarea performan»õƒÉ la quiz:\n\nElev: Ana Moraru\nTimp: 4:32/5:00\nRƒÉspunsuri corecte: 3/3\n\nOferƒÉ: 1) Evaluare generalƒÉ, 2) NotƒÉ sugeratƒÉ (1-10), 3) RecomandƒÉri.`
                    : `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞:\n\n–£—á–µ–Ω–∏–∫: Ana Moraru\n–í—Ä–µ–º—è: 4:32/5:00\n–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã: 3/3\n\n–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ: 1) –û–±—â—É—é –æ—Ü–µ–Ω–∫—É, 2) –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—É—é –æ—Ü–µ–Ω–∫—É (1-10), 3) –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.`;
                
                const analysis = await callAIProvider(prompt, systemMessage);
                alert(`ü§ñ AI –ê–Ω–∞–ª–∏–∑ (${AI_CONFIG.provider.toUpperCase()}):\n\n${analysis}`);
                
            } catch (error) {
                console.error('Eroare analizƒÉ AI:', error);
                const fallback = cL === 'RO' ?
                    'AnalizƒÉ AI:\n\n‚úì Elev: Ana Moraru\n‚úì Timp: 4:32/5:00\n‚úì RƒÉspunsuri complete: 3/3\n‚úì Calitate medie: 8.5/10\n\nRecomandare: Elevul demonstreazƒÉ √Æn»õelegere bunƒÉ a subiectului. NotƒÉ sugeratƒÉ: 9/10' :
                    'AI –ê–Ω–∞–ª–∏–∑:\n\n‚úì –£—á–µ–Ω–∏–∫: Ana Moraru\n‚úì –í—Ä–µ–º—è: 4:32/5:00\n‚úì –ü–æ–ª–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã: 3/3\n‚úì –°—Ä–µ–¥–Ω. –∫–∞—á–µ—Å—Ç–≤–æ: 8.5/10\n\n–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –£—á–µ–Ω–∏–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ö–æ—Ä–æ—à–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–º—ã. –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è –æ—Ü–µ–Ω–∫–∞: 9/10';
                alert(fallback);
            }
        }

        // ============================================
        // VERIFICARE OCR
        // ============================================

        function handleOCRUpload(input) {
            if(input.files.length > 0) {
                const file = input.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    ocrImage = e.target.result;
                    document.getElementById('ocr-image').src = ocrImage;
                    document.getElementById('ocr-preview').classList.remove('hidden');
                    document.getElementById('ocr-result').classList.add('hidden');
                };
                
                reader.readAsDataURL(file);
            }
        }

        async function processOCR() {
            showNotification(cL === 'RO' ? 'Se proceseazƒÉ cu AI...' : '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Å AI...');
            
            try {
                // NotƒÉ: OCR real necesitƒÉ servicii precum Tesseract.js sau Cloudflare Vision
                // Aici facem doar analiza AI a textului extras (simulat pentru MVP)
                
                const extractedText = cL === 'RO' ?
                    'Nilul a fost vital pentru civiliza»õia egipteanƒÉ deoarece:\n1. Asigura apƒÉ pentru agriculturƒÉ\n2. Fertiliza solul prin inunda»õii\n3. Permitea transportul\n\nConcluzie: FƒÉrƒÉ Nil, Egiptul antic nu ar fi putut prospera.' :
                    '–ù–∏–ª –±—ã–ª –∂–∏–∑–Ω–µ–Ω–Ω–æ –≤–∞–∂–µ–Ω –¥–ª—è –µ–≥–∏–ø–µ—Ç—Å–∫–æ–π —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç–æ–º—É —á—Ç–æ:\n1. –û–±–µ—Å–ø–µ—á–∏–≤–∞–ª –≤–æ–¥–æ–π —Å–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ\n2. –£–¥–æ–±—Ä—è–ª –ø–æ—á–≤—É –Ω–∞–≤–æ–¥–Ω–µ–Ω–∏—è–º–∏\n3. –ü–æ–∑–≤–æ–ª—è–ª —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫—É\n\n–í—ã–≤–æ–¥: –ë–µ–∑ –ù–∏–ª–∞ –¥—Ä–µ–≤–Ω–∏–π –ï–≥–∏–ø–µ—Ç –Ω–µ –º–æ–≥ –±—ã –ø—Ä–æ—Ü–≤–µ—Ç–∞—Ç—å.';
                
                document.getElementById('ocr-text').innerText = extractedText;
                document.getElementById('ocr-result').classList.remove('hidden');
                
                // Apel AI pentru feedback
                const systemMessage = cL === 'RO'
                    ? 'E»ôti profesor de istorie. EvalueazƒÉ rƒÉspunsul elevului extras prin OCR »ôi oferƒÉ feedback constructiv.'
                    : '–í—ã —É—á–∏—Ç–µ–ª—å –∏—Å—Ç–æ—Ä–∏–∏. –û—Ü–µ–Ω–∏—Ç–µ –æ—Ç–≤–µ—Ç —É—á–µ–Ω–∏–∫–∞, –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —á–µ—Ä–µ–∑ OCR, –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å.';
                
                const prompt = cL === 'RO'
                    ? `EvalueazƒÉ acest rƒÉspuns despre Nilul √Æn Egiptul Antic:\n\n"${extractedText}"\n\nOferƒÉ: 1) Puncte forte, 2) Ce lipse»ôte, 3) NotƒÉ sugeratƒÉ (1-10).`
                    : `–û—Ü–µ–Ω–∏—Ç–µ —ç—Ç–æ—Ç –æ—Ç–≤–µ—Ç –æ –ù–∏–ª–µ –≤ –î—Ä–µ–≤–Ω–µ–º –ï–≥–∏–ø—Ç–µ:\n\n"${extractedText}"\n\n–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ: 1) –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã, 2) –ß–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç, 3) –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—É—é –æ—Ü–µ–Ω–∫—É (1-10).`;
                
                const feedback = await callAIProvider(prompt, systemMessage);
                document.getElementById('ocr-feedback').innerText = feedback;
                
            } catch (error) {
                console.error('Eroare procesare OCR:', error);
                const fallback = cL === 'RO' ?
                    'RƒÉspuns complet »ôi structurat corect. Elevul a identificat toate aspectele importante. NotƒÉ sugeratƒÉ: 9.5/10. Recomandare: Excelent!' :
                    '–ü–æ–ª–Ω—ã–π –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç. –£—á–µ–Ω–∏–∫ –æ–ø—Ä–µ–¥–µ–ª–∏–ª –≤—Å–µ –≤–∞–∂–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã. –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è –æ—Ü–µ–Ω–∫–∞: 9.5/10. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –û—Ç–ª–∏—á–Ω–æ!';
                document.getElementById('ocr-feedback').innerText = fallback;
            }
        }

        // ============================================
        // INI»öIALIZARE DATE DEMO
        // ============================================

        function initTeacherData() {
            materials = [
                { name: 'Prezentare_Egiptul_Antic.pptx', size: '2.4 MB', type: 'application/vnd.ms-powerpoint', uploadedBy: 'Prof. Ruslan', date: new Date().toLocaleDateString('ro-RO') },
                { name: 'Manual_Antichitate.pdf', size: '15.8 MB', type: 'application/pdf', uploadedBy: 'Prof. Ruslan', date: new Date().toLocaleDateString('ro-RO') }
            ];
            renderMaterials();
            
            submittedHomework = [
                { student: 'Ana Moraru', answer: 'Nilul a jucat un rol crucial...', files: [], date: new Date().toLocaleString('ro-RO') }
            ];
            renderSubmittedWorks();
        }

        function initStudentData() {
            // Simulare sesiune online activƒÉ
            setTimeout(() => {
                if(Math.random() > 0.5) {
                    showStudentSession('Orientul Antic: Egipt', 'DiscutƒÉm despre importan»õa Nilului »ôi organizarea socialƒÉ', 'https://meet.history-cosmos.ai/abc123xyz');
                }
            }, 1000);
        }

        // ============================================
        // CRONICUS AI FUNCTIONS
        // ============================================
        
        // Ini»õializare evenimente CRONICUS
        function initCronicus() {
            // Actualizare indicator mod la schimbare
            document.querySelectorAll('input[name="cronicus-mode"]').forEach(radio => {
                radio.addEventListener('change', updateModeIndicator);
            });
            
            // Actualizare numƒÉr caractere
            const questionInput = document.getElementById('cronicus-question');
            if (questionInput) {
                questionInput.addEventListener('input', updateCharCount);
                updateCharCount(); // Ini»õializare
            }
            
            updateModeIndicator(); // Ini»õializare indicator
        }
        
        // Actualizare indicator mod
        function updateModeIndicator() {
            const mode = document.querySelector('input[name="cronicus-mode"]:checked').value;
            const indicator = document.getElementById('mode-indicator');
            
            if (mode === 'rapid') {
                indicator.textContent = cL === 'RO'
                    ? 'Mod: Rapid (120-200 cuvinte)'
                    : '–†–µ–∂–∏–º: –ë—ã—Å—Ç—Ä—ã–π (120-200 —Å–ª–æ–≤)';
                indicator.className = 'text-xs text-blue-400';
            } else {
                indicator.textContent = cL === 'RO'
                    ? 'Mod: Profund (analizƒÉ detaliatƒÉ + evaluare BAC)'
                    : '–†–µ–∂–∏–º: –ì–ª—É–±–æ–∫–∏–π (–¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ + –æ—Ü–µ–Ω–∫–∞ BAC)';
                indicator.className = 'text-xs text-purple-400';
            }
        }
        
        // Actualizare numƒÉr caractere
        function updateCharCount() {
            const question = document.getElementById('cronicus-question').value;
            const charCount = document.getElementById('char-count');
            const errorMsg = document.getElementById('min-chars-error');
            
            const count = question.length;
            charCount.textContent = `${count} ${cL === 'RO' ? 'caractere' : '—Å–∏–º–≤–æ–ª–æ–≤'}`;
            
            // Validare minim 5 caractere
            if (count > 0 && count < 5) {
                errorMsg.classList.remove('hidden');
                charCount.className = 'text-xs text-red-500';
            } else {
                errorMsg.classList.add('hidden');
                charCount.className = count >= 5 ? 'text-xs text-green-500' : 'text-xs text-slate-500';
            }
        }
        
        // Func»õia principalƒÉ askCronicus()
        async function askCronicus() {
            const question = document.getElementById('cronicus-question').value.trim();
            const mode = document.querySelector('input[name="cronicus-mode"]:checked').value;
            
            // Validare
            if (!question) {
                showError(cL === 'RO' ? 'Introdu o √Æntrebare!' : '–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å!');
                return;
            }
            
            if (question.length < 5) {
                showError(cL === 'RO' ? '√éntrebarea trebuie sƒÉ aibƒÉ minim 5 caractere!' : '–í–æ–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤!');
                return;
            }
            
            // Ascunde erori anterioare
            hideError();
            
            // Afi»ôeazƒÉ loading state
            showLoading(mode);
            
            // AdaugƒÉ √Æntrebarea √Æn chat
            addQuestionToChat(question);
            
            try {
                // URL backend (folose»ôte API_BASE_URL definit mai sus sau localhost pentru development)
                const apiUrl = API_BASE_URL ? `${API_BASE_URL}/api/cronicus` : '/api/cronicus';
                
                // Trimite cererea cƒÉtre backend
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        question: question,
                        mode: mode
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || `HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                // Ascunde loading
                hideLoading();
                
                // AdaugƒÉ rƒÉspunsul √Æn chat
                addResponseToChat(data.answer, mode, data.metadata);
                
                // ReseteazƒÉ input-ul
                document.getElementById('cronicus-question').value = '';
                updateCharCount();
                
            } catch (error) {
                console.error('Eroare CRONICUS:', error);
                hideLoading();
                
                // Afi»ôeazƒÉ eroare
                const errorMessage = cL === 'RO'
                    ? `Eroare: ${error.message}. VerificƒÉ conexiunea la internet »ôi √ÆncearcƒÉ din nou.`
                    : `–û—à–∏–±–∫–∞: ${error.message}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.`;
                
                showError(errorMessage);
                
                // Fallback: rƒÉspuns simulat
                addSimulatedResponse(question, mode);
            }
        }
        
        // Afi»ôeazƒÉ loading state
        function showLoading(mode) {
            const loadingEl = document.getElementById('cronicus-loading');
            const detailsEl = document.getElementById('loading-details');
            
            if (mode === 'rapid') {
                detailsEl.textContent = cL === 'RO'
                    ? 'Se genereazƒÉ rƒÉspuns rapid (Mistral 7B)...'
                    : '–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç (Mistral 7B)...';
            } else {
                detailsEl.textContent = cL === 'RO'
                    ? 'Se analizeazƒÉ √Æn detaliu (Llama 70B)...'
                    : '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–æ (Llama 70B)...';
            }
            
            loadingEl.classList.remove('hidden');
            document.getElementById('ask-cronicus-btn').disabled = true;
        }
        
        // Ascunde loading state
        function hideLoading() {
            document.getElementById('cronicus-loading').classList.add('hidden');
            document.getElementById('ask-cronicus-btn').disabled = false;
        }
        
        // Afi»ôeazƒÉ eroare
        function showError(message) {
            const errorEl = document.getElementById('cronicus-error');
            const messageEl = document.getElementById('error-message');
            
            messageEl.textContent = message;
            errorEl.classList.remove('hidden');
        }
        
        // Ascunde eroare
        function hideError() {
            document.getElementById('cronicus-error').classList.add('hidden');
        }
        
        // AdaugƒÉ √Æntrebarea √Æn chat
        function addQuestionToChat(question) {
            const responsesContainer = document.getElementById('cronicus-responses');
            
            const questionHtml = `
                <div class="flex gap-3 mb-6 justify-end">
                    <div class="bg-blue-600 p-4 rounded-2xl rounded-tr-none max-w-xl">
                        <p class="text-sm text-white">${escapeHtml(question)}</p>
                    </div>
                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-user text-white text-sm"></i>
                    </div>
                </div>
            `;
            
            responsesContainer.insertAdjacentHTML('beforeend', questionHtml);
            
            // Scroll la ultimul mesaj
            scrollToBottom();
        }
        
        // AdaugƒÉ rƒÉspunsul √Æn chat
        function addResponseToChat(answer, mode, metadata) {
            const responsesContainer = document.getElementById('cronicus-responses');
            const modeIcon = mode === 'rapid' ? '‚ö°' : 'üéì';
            const modeColor = mode === 'rapid' ? 'blue' : 'purple';
            
            const responseHtml = `
                <div class="flex gap-3 mb-6 chat-bubble">
                    <div class="w-8 h-8 bg-slate-700 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-robot text-${modeColor}-400 text-sm"></i>
                    </div>
                    <div class="bg-slate-800 p-4 rounded-2xl rounded-tl-none max-w-xl">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-xs font-bold text-${modeColor}-400">CRONICUS ${modeIcon}</span>
                            <span class="text-xs text-slate-500">‚Ä¢ ${metadata?.wordCount || '?'} ${cL === 'RO' ? 'cuvinte' : '—Å–ª–æ–≤'}</span>
                        </div>
                        <div class="text-sm text-slate-300 whitespace-pre-line">${formatAnswer(answer)}</div>
                        <div class="mt-3 pt-3 border-t border-slate-700">
                            <p class="text-xs text-slate-500">
                                ${mode === 'rapid'
                                    ? (cL === 'RO' ? '‚ö° RƒÉspuns rapid generat cu Mistral 7B' : '‚ö° –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω Mistral 7B')
                                    : (cL === 'RO' ? 'üéì AnalizƒÉ detaliatƒÉ cu Llama 70B' : 'üéì –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å Llama 70B')}
                            </p>
                        </div>
                    </div>
                </div>
            `;
            
            responsesContainer.insertAdjacentHTML('beforeend', responseHtml);
            
            // Scroll la ultimul mesaj
            scrollToBottom();
        }
        
        // RƒÉspuns simulat pentru fallback
        function addSimulatedResponse(question, mode) {
            const simulatedResponses = {
                rapid: {
                    ro: `ExcelentƒÉ √Æntrebare despre "${question.substring(0, 30)}..."! √én istorie, acest subiect este esen»õial pentru √Æn»õelegerea proceselor sociale »ôi economice din perioada respectivƒÉ. Recomand sƒÉ studiezi mai multe surse primare pentru o perspectivƒÉ completƒÉ.`,
                    ru: `–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å –æ "${question.substring(0, 30)}..."! –í –∏—Å—Ç–æ—Ä–∏–∏ —ç—Ç–∞ —Ç–µ–º–∞ –≤–∞–∂–Ω–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –∏ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Ç–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞. –†–µ–∫–æ–º–µ–Ω–¥—É—é –∏–∑—É—á–∏—Ç—å –±–æ–ª—å—à–µ –ø–µ—Ä–≤–æ–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–ª—è –ø–æ–ª–Ω–æ–π –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã.`
                },
                profund: {
                    ro: `üìä **ANALIZƒÇ DETALIATƒÇ**\n\n**Context istoric:** Subiectul tƒÉu se √ÆncadreazƒÉ √Æn perioada...\n\n**Puncte cheie:**\n1. Factorul economic\n2. Influen»õa socialƒÉ\n3. Consecin»õe politice\n\n**Evaluare BAC estimativƒÉ:** 12/15 puncte\n\n**RecomandƒÉri:**\n‚Ä¢ Cite»ôte lucrƒÉrile autorului X\n‚Ä¢ AnalizeazƒÉ documentele primare Y\n‚Ä¢ ComparƒÉ cu cazuri similare din istoria universalƒÉ`,
                    ru: `üìä **–î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó**\n\n**–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:** –í–∞—à–∞ —Ç–µ–º–∞ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –ø–µ—Ä–∏–æ–¥—É...\n\n**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**\n1. –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç–æ—Ä\n2. –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ\n3. –ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è\n\n**–û—Ü–µ–Ω–∫–∞ BAC –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ:** 12/15 –±–∞–ª–ª–æ–≤\n\n**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**\n‚Ä¢ –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ä–∞–±–æ—Ç—ã –∞–≤—Ç–æ—Ä–∞ X\n‚Ä¢ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø–µ—Ä–≤–∏—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã Y\n‚Ä¢ –°—Ä–∞–≤–Ω–∏—Ç–µ —Å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º–∏ —Å–ª—É—á–∞—è–º–∏ –∏–∑ –≤—Å–µ–º–∏—Ä–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏`
                }
            };
            
            const response = simulatedResponses[mode][cL === 'RO' ? 'ro' : 'ru'];
            addResponseToChat(response, mode, { wordCount: response.split(/\s+/).length });
        }
        
        // FormateazƒÉ rƒÉspunsul (converte»ôte markdown simplu)
        function formatAnswer(text) {
            // Convertire markdown simplu
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/‚úÖ/g, '‚úÖ ')
                .replace(/‚ö†Ô∏è/g, '‚ö†Ô∏è ')
                .replace(/\n/g, '<br>');
        }
        
        // Escape HTML pentru securitate
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Scroll la ultimul mesaj
        function scrollToBottom() {
            const chatContainer = document.getElementById('cronicus-chat');
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // »òterge conversa»õia
        function clearCronicusChat() {
            if (confirm(cL === 'RO' ? 'Sigur »ôtergi conversa»õia?' : '–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä?')) {
                document.getElementById('cronicus-responses').innerHTML = '';
                showNotification(cL === 'RO' ? 'Conversa»õie »ôtearsƒÉ!' : '–†–∞–∑–≥–æ–≤–æ—Ä —É–¥–∞–ª–µ–Ω!');
            }
        }
        
        // Aplicare traduceri la √ÆncƒÉrcare
        window.addEventListener('DOMContentLoaded', () => {
            applyTranslations();
            initCronicus();
        });
        
        // Drag & Drop pentru upload zone
        document.addEventListener('DOMContentLoaded', () => {
            const uploadZones = document.querySelectorAll('.upload-zone');
            uploadZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.classList.add('dragover');
                });
                
                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('dragover');
                });
                
                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('dragover');
                    // Procesare fi»ôiere aici
                });
            });
        });
    </script>
</body>
</html>
